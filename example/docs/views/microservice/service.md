---
title: 微服务架构思想
date: 2020-07-03 12:00:00
tags:
 - 微服务
categories:
 - 微服务
---

## 一、传统Java EE项目
Java EE作为面向企业级的开发。主要做面向企业的办公软件、信息处理软件。这些业务在B/S架构下，Web为开发的主要方式。我们或用ssh、或用ssm等开发框架做**单体程序**。<br>
OA、CRM、EPR ===>> 三层架构 ===>> 集群<br>

在传统的三层架构中，我们一般分Controller控制层、service业务层、DAO数据访问层。我们把一个系统的所有模块都放在单体应用内。单体应用存在的问题，当系统一个小模块出现问题，整个系统的健康都会受到威胁。尤其是在企业巨型应用，这个问题很严重，在微服务架构中，我们考虑将单体应用分成独立模块进行独立部署，**实现解耦**。

## 二、微服务架构解决的问题

::: tip Microservices —— Martin Fowler
就目前而言，对于微服务业界并没有一个统一的、标准的定义（While there is no precise definition of this architectural style ) 。
但通常在其而言，微服务架构是一种架构模式或者说是一种架构风格，它提倡将单一应用程序划分成一组小的服务，每个服务运行独立的自己的进程中，服务之间互相协调、互相配合，为用户提供最终价值。
服务之间采用轻量级的通信机制互相沟通（通常是基于 HTTP 的 RESTful API ) 。每个服务都围绕着具体业务进行构建，并且能够被独立地部署到生产环境、类生产环境等。
另外，应尽量避免统一的、集中式的服务管理机制，对具体的一个服务而言，应根据业务上下文，选择合适的语言、工具对其进行构建，可以有一个非常轻量级的集中式管理来协调这些服务。可以使用不同的语言来编写服务，也可以使用不同的数据存储。

[https://martinfowler.com/](https://martinfowler.com/)

:::



### 二（1）、满足指标
高可用、高并发、高性能

#### **性能提升**：

**1、垂直扩展**

增加单台机器的CPU核心数、内存大小

**2、水平扩展**

部署多台、负载均衡

#### **数据库扩展**：

数据库的水平扩展，将传统的关系型数据库进行分布式扩展。比如Mysql的索引是B+ tree，一个Page为16Kb。这个是存在性能瓶颈的，单表的数据量 2000 万以后，对sql执行性能就有很大影响。<br>

所以需要引入分布式数据库中间件（Mycat、Sharding-Sphere等），配置多台水平数据库进行分库分表。

#### **系统分类**：

根据不同的系统，我看对CPU和内存的需求不同：可分为计算密集型（CPU要求高）、存储密集型（内存要求高）。

#### **负载均衡策略**：

1、轮询（机器配置相同）

2、hash一致（CDN根据服务器位置）

3、权重（不同服务器性能不同）

4、ip绑定







### 二（2）、解决问题

1、客户端如何访问

2、服务与服务的通信

3、服务治理

4、服务健康





## 三、基本概念学习

### 三（1）、CAP原则

`CAP`原理指的是，在分布式系统中这三个要素最多只能同时实现两点，不可能三者兼顾。

- **一致性**（`Consistency`）：**原子性**、数据在多个副本之间保持**强一致性**。
- **可用性**（`Availability`）：系统提供的服务必须一直处于可用状态，对每一个操作的请求必须在有限时间内返回结果。
- **分区容错性**（`Tolerance of network Partition`）：分布式系统在遇到网络分区故障时，仍然需要保证对外提供一致性和可用性的服务，除非整个网络都发生故障。

所以根据对数据一致性的要求，现在的系统都是CP或AP系统。



### 三（2）、BASE理论

BASE 理论是对 **CAP 理论的延伸**，核心思想是即使无法做到强一致性（Strong Consistency，CAP 的一致性就是强一致性），但应用可以采用适合的方式达到**最终一致性**（Eventual Consitency）。

- **基本可用(Basically Available)**： 基本可用是指分布式系统在出现故障的时候，允许损失部分可用性，即保证核心可用。电商大促时，为了应对访问量激增，部分用户可能会被引导到降级页面，服务层也可能只提供降级服务。这就是损失部分可用性的体现。
- **软状态(Soft State)**： 软状态是指允许系统存在中间状态，而该中间状态不会影响系统整体可用性。分布式存储中一般一份数据至少会有三个副本，允许不同节点间副本同步的延时就是软状态的体现。MySQL Replication 的异步复制也是一种体现。
- **最终一致性(Eventual Consistency)**： 最终一致性是指系统中的所有数据副本经过一定时间后，最终能够达到一致的状态。弱一致性和强一致性相反，最终一致性是弱一致性的一种特殊情况。


## 四、微服务的设计模式




















&nbsp;&nbsp;&nbsp;&nbsp; 本人授权[维权骑士](http://rightknights.com)对我发布文章的版权行为进行追究与维权。未经本人许可，不可擅自转载或用于其他商业用途。


